/* è´¦ç›®çš„æ“ä½œ:åŠ è½½æ•°æ®ã€æ“ä½œæ•°æ®ã€æŸ¥è¯¢æ•°æ® */
#include "common.h"// ç»Ÿä¸€å¼•å…¥æ‰€æœ‰çš„å¤´æ–‡ä»¶
#include "account_Item.h" // å¼•å…¥æ•°æ®ç»“æ„ä½“, æ‰èƒ½æ‹¿åˆ° AccountItem ç±»å‹çš„æ•°æ®



// åŠ è½½è´¦å•æ•°æ®çš„åŠŸèƒ½ â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
void loadDataFromFile(vector<AccountItem>& allItems) { //ğŸ”¥è®°å¾—åœ¨ account_Item.h è¿›è¡Œå£°æ˜ï¼ï¼
	ifstream input(FILENAME); //æ‹¿åˆ°æ–‡ä»¶æ•°æ® => åœ¨ common.h ä¸­å®šä¹‰äº†å…¨å±€å˜é‡

	AccountItem item; // é€è¡Œè¯»å–æ¯æ¡è´¦ç›®, å¹¶æ”¾å…¥ AccountItem

	while(input >> item.itemType >> item.amount >> item.detail) { // ğŸ”¥ğŸ”¥é€è¯è¯»å–, è¿™æ ·æ›´å¥½æ‹†åˆ† ç±»å‹ã€æ€»æ•°ã€å¤‡æ³¨
		allItems.push_back(item); // push_back ä¸º vector çš„æ–¹æ³•, ç”¨äºå‘æ•°ç»„ä¸­æ·»åŠ å…ƒç´ 
	}
}



// è¿›è¡Œè®°è´¦çš„åŠŸèƒ½(æ”¶å…¥æˆ–æ”¯å‡º) â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
void editAccountAction(vector<AccountItem>& allItems) { //ğŸ”¥è®°å¾—åœ¨ account_Item.h è¿›è¡Œå£°æ˜ï¼ï¼
	//1.è¯»å–ç”¨æˆ·çš„è¾“å…¥ä¿¡æ¯ (è´¦å•ã€ç±»å‹ã€å¤‡æ³¨)
	char keyboardInfo = readMenuSelected(3); // 3 æ˜¯å› ä¸ºè®°è´¦èœå•æœ‰ 3 ä¸ªé€‰é¡¹

	switch(keyboardInfo) {
		case '1': // ã€æ”¶å…¥ã€‘
		addInCome(allItems); // ä¼ å…¥æ•´ä¸ªè´¦å•, è®°å½•æ”¶å…¥
		break;

		case '2': // ã€æ”¯å‡ºã€‘
		expand(allItems); // ä¼ å…¥æ•´ä¸ªè´¦å•, è®°å½•æ”¯å‡º
		break;

		case '3': // ã€é€€å‡ºåˆ°ä¸»èœå•ã€‘
			break;

		default: 
			break;
	}
}


// ğŸŒŸ è®°å½•ä¸€ç¬”æ”¶å…¥çš„åŠŸèƒ½ (ğŸ‘†ä¸Šé¢ editAccountAction çš„å­é›†)
void addInCome(vector<AccountItem>& allItems) { //ğŸ”¥è®°å¾—åœ¨ account_Item.h è¿›è¡Œå£°æ˜ï¼ï¼
	// 1.å®šä¹‰ä¸€æ¡è´¦ç›®æ•°æ®
	AccountItem item;

	// 2.ç±»å‹ -> æ”¶å…¥
	item.itemType = INCOME; // ğŸ”¥ğŸ”¥ INCOME ä¸ºå¸¸é‡, åœ¨ common.h ä¸­è¿›è¡Œäº†å®å®šä¹‰

	// 3.ä¸ç”¨æˆ·äº¤äº’, æç¤ºç”¨æˆ·è¾“å…¥é‡‘é¢
	cout << "\n è¾“å…¥æœ¬æ¬¡æ”¶å…¥é‡‘é¢: "; //ç”¨æˆ·è¾“å…¥å°±åœ¨åé¢, æ‰€ä»¥ä¸ç”¨ endl æ¢è¡Œ

	// ğŸ”¥4.è¯»å–ç”¨æˆ·è¾“å…¥çš„é‡‘é¢, å¹¶æ ¡éªŒåˆæ³•æ€§ï¼ˆ => åœ¨ read_input å†…å®ç°ï¼‰, ç„¶åå­˜åˆ° item.amount ä¸­
	item.amount = readAmount(); // å­˜å…¥ item.amount

	// 5.ä¿å­˜ç”¨æˆ·è¾“å…¥çš„å¤‡æ³¨
	cout << "\n å¤‡æ³¨: ";
	getline(cin, item.detail); // ğŸ‘ˆğŸ‘ˆ cin è¡¨ç¤ºè·å¾—ç”¨æˆ·çš„è¾“å…¥, å¹¶ä¿å­˜åœ¨ item.detail å†…ï¼

	// 6. æŠŠè¿™æ¡è´¦ç›® item, æ·»åŠ åˆ° allItems æ•°ç»„ä¸­
	allItems.push_back(item);

	// ğŸ”¥7.æŒä¹…åŒ–ä¿å­˜åˆ°æ–‡ä»¶ä¸­
	insertIntoFile(item);

	// 8. æ˜¾ç¤ºæˆåŠŸä¿¡æ¯
	cout << "\n â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” ğŸ‰ è®°è´¦æˆåŠŸï¼ â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” \n" << endl;
	cout << "\n è¯·æŒ‰å›è½¦é”®è¿”å›ä¸»èœå•..." << endl;

	// 9. æ•æ‰ç”¨æˆ·å›è½¦äº‹ä»¶(å›è½¦è¿”å›ä¸»èœå•)
	string line;
	getline(cin, line); //ä¸åšä»»ä½•å¤„ç†, ç›¸å½“äºç›´æ¥ä¸¢å¼ƒè·å¾—çš„ line, ç„¶å return å›åˆ° main å‡½æ•°çš„ while å¾ªç¯å¤„, è¿™é‡Œåˆšå¥½åˆ° break äº†, æ‰€ä»¥æ¯å›åˆ°ã€ä¸»èœå•ã€‘
}


// ğŸŒŸ è®°å½•ä¸€ç¬”æ”¯å‡ºçš„åŠŸèƒ½ (ğŸ‘†ä¸Šé¢ editAccountAction çš„å­é›†)
void expand(vector<AccountItem>& allItems) { //ğŸ”¥è®°å¾—åœ¨ account_Item.h è¿›è¡Œå£°æ˜ï¼ï¼
	// 1.å®šä¹‰ä¸€æ¡è´¦ç›®æ•°æ®
	AccountItem item;

	// 2.ç±»å‹ -> æ”¯å‡º
	item.itemType = EXPAND; // ğŸ”¥ğŸ”¥ INCOME ä¸ºå¸¸é‡, åœ¨ common.h ä¸­è¿›è¡Œäº†å®å®šä¹‰

	// 3.ä¸ç”¨æˆ·äº¤äº’, æç¤ºç”¨æˆ·è¾“å…¥é‡‘é¢
	cout << "\n è¾“å…¥æœ¬æ¬¡æ”¯å‡ºé‡‘é¢: "; //ç”¨æˆ·è¾“å…¥å°±åœ¨åé¢, æ‰€ä»¥ä¸ç”¨ endl æ¢è¡Œ

	// ğŸ”¥4.è¯»å–ç”¨æˆ·è¾“å…¥çš„é‡‘é¢, å¹¶æ ¡éªŒåˆæ³•æ€§,ï¼ˆ => åœ¨ read_input å†…å®ç°ï¼‰ ç„¶åå­˜åˆ° item.amount ä¸­
	item.amount = - readAmount(); // å­˜å…¥ item.amount => âš¡ï¸âš¡ï¸ æ”¯å‡º, å–è´Ÿæ•°ï¼

	// 5.ä¿å­˜ç”¨æˆ·è¾“å…¥çš„å¤‡æ³¨
	cout << "\n å¤‡æ³¨: ";
	getline(cin, item.detail); // ğŸ‘ˆğŸ‘ˆ cin è¡¨ç¤ºè·å¾—ç”¨æˆ·çš„è¾“å…¥, å¹¶ä¿å­˜åœ¨ item.detail å†…ï¼

	// 6. æŠŠè¿™æ¡è´¦ç›® item, æ·»åŠ åˆ° allItems æ•°ç»„ä¸­
	allItems.push_back(item);

	// ğŸ”¥7.æŒä¹…åŒ–ä¿å­˜åˆ°æ–‡ä»¶ä¸­
	insertIntoFile(item);

	// 8. æ˜¾ç¤ºæˆåŠŸä¿¡æ¯
	cout << "\n â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” ğŸ‰ è®°è´¦æˆåŠŸï¼ â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” \n" << endl;
	cout << "\n è¯·æŒ‰å›è½¦é”®è¿”å›ä¸»èœå•..." << endl;

	// 9. ç”¨æˆ·å›è½¦äº‹ä»¶
	string line;
	getline(cin, line); //ä¸åšä»»ä½•å¤„ç†, ç›¸å½“äºç›´æ¥ä¸¢å¼ƒè·å¾—çš„ line, ç„¶å return å›åˆ° main å‡½æ•°çš„ while å¾ªç¯å¤„, è¿™é‡Œåˆšå¥½åˆ° break äº†, æ‰€ä»¥æ¯å›åˆ°ã€ä¸»èœå•ã€‘
}


// âœï¸ å°†å•æ¡è´¦å•å†™å…¥åˆ°æ–‡ä»¶ä¸­
void insertIntoFile(const AccountItem& item) { // ğŸ‘ˆ allItems æœ¬èº«ä¸åšæ›´æ”¹, è€Œæ˜¯æ–°å¢
	// åˆ›å»ºä¸€ä¸ª ofstream å¯¹è±¡ => å†™å…¥æ–‡ä»¶ => ç›´æ¥å†™æ˜¯è¦†ç›–, ğŸš€ğŸš€ æ‰€ä»¥è¦ç”¨ã€è¿½åŠ ã€‘çš„æ–¹å¼å†™å…¥
	ofstream outputFile(FILENAME, ios::out | ios::app); // ğŸš€ğŸš€ ios::app è¡¨ç¤ºä»¥è¿½åŠ (append)çš„æ–¹å¼è¿›è¡Œæ–‡ä»¶çš„ã€å†™å…¥ã€‘
	outputFile << item.itemType << "\t" << item.amount << "\t" << item.detail << endl;//ğŸ”¥ğŸ”¥ ã€æ‹¿åˆ°æ•°æ® -> å†™å…¥ fileã€‘æŠŠ item.itemTypeã€ item.amountã€ item.detail å†™å…¥åˆ°æ–‡ä»¶ä¸­
	outputFile.close(); //åœæ­¢å†™å…¥æµ
}



// è¿›è¡Œè´¦å•æŸ¥è¯¢çš„åŠŸèƒ½åˆ¤æ–­å‡½æ•° â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
void queryAccountAction(const vector<AccountItem>& allItems) { //ğŸ”¥è®°å¾—åœ¨ account_Item.h è¿›è¡Œå£°æ˜ï¼ï¼
	char keyboardInfo = readMenuSelected(4); // 4 æ˜¯å› ä¸ºæŸ¥è¯¢èœå•æœ‰ 4 ä¸ªé€‰é¡¹
	switch(keyboardInfo)  {
		case '1': //æŸ¥è¯¢æ‰€æœ‰è´¦ç›®, å¹¶ç»Ÿè®¡æ€»æ”¶æ”¯
			queryItems(allItems);
			break;

		case '2': //æŸ¥è¯¢æ‰€æœ‰è´¦ç›®, å¹¶ç»Ÿè®¡æ€»æ”¶å…¥
			queryItems(allItems, INCOME); // ğŸ”¥INCOME ä¸ºçš„å¸¸é‡, åœ¨ common.h ä¸­è¿›è¡Œäº†å®å®šä¹‰, è¿™é‡Œç”¨æ¥ç­›é€‰è´¦ç›®
			break;

		case '3': //æŸ¥è¯¢æ‰€æœ‰è´¦ç›®, å¹¶ç»Ÿè®¡æ€»æ”¯å‡º
			queryItems(allItems, EXPAND); // ğŸ”¥EXPAND ä¸ºçš„å¸¸é‡, åœ¨ common.h ä¸­è¿›è¡Œäº†å®å®šä¹‰, è¿™é‡Œç”¨æ¥ç­›é€‰è´¦ç›®
			break;

		case '4': //é€€å›ä¸»èœå•
			break;

		default: //å¦‚æœè¾“å…¥çš„ä¸æ˜¯ 1ã€2ã€3ã€4, åˆ™é€€å›ä¸»èœå•
			// break;
			// é‡æ–°æ˜¾ç¤ºæŸ¥è¯¢èœå•
			showQueryMenu();
			return;
	}
}


// æŸ¥è¯¢ã€æ€»è´¦ç›®ã€‘çš„å…·ä½“å®ç°
void queryItems(const vector<AccountItem>& allItems) { //ğŸ”¥è®°å¾—åœ¨ account_Item.h è¿›è¡Œå£°æ˜ï¼ï¼
	cout << "â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” ğŸ‘€ æŸ¥è¯¢ç»“æœ â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”" << endl;
	cout << "\n ç±»å‹ \t\t é‡‘é¢ \t\t å¤‡æ³¨ \n" << endl;

	// 1.éå†æ‰€æœ‰è´¦ç›®, ç»Ÿè®¡æ€»æ”¶æ”¯
	int total = 0;
	for(auto item: allItems) { //èŒƒå›´ for å¾ªç¯, auto è‡ªåŠ¨æ¨æ–­
		printItem(item);  //ğŸ”¥è®°å¾—åœ¨ account_Item.h è¿›è¡Œå£°æ˜ï¼ï¼
		total += item.amount; //è®¡ç®—æ€»é‡‘é¢
	}

	// 2.è¾“å‡ºä¿¡æ¯
	cout << "â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”" << endl;
	cout << "æ€»æ”¶æ”¯: "  << total << endl;
	cout << "æŒ‰å›è½¦é”®è¿”å›ä¸»èœå•" << endl;

	// 3. æ•æ‰ç”¨æˆ·å›è½¦äº‹ä»¶(å›è½¦è¿”å›ä¸»èœå•)
	string line;
	getline(cin, line); //ä¸åšä»»ä½•å¤„ç†, ç›¸å½“äºç›´æ¥ä¸¢å¼ƒè·å¾—çš„ line, ç„¶å return å›åˆ° main å‡½æ•°çš„ while å¾ªç¯å¤„, è¿™é‡Œåˆšå¥½åˆ° break äº†, æ‰€ä»¥æ¯å›åˆ°ã€ä¸»èœå•ã€‘
}


// æŸ¥è¯¢ã€æ€»æ”¶å…¥ æˆ– æ€»æ”¯å‡ºã€‘çš„å…·ä½“å®ç° //ğŸ”¥è®°å¾—åœ¨ account_Item.h è¿›è¡Œå£°æ˜ï¼ï¼
void queryItems(const vector<AccountItem>& allItems, const string type) { // ç”¨ type åˆ¤æ–­æ˜¯æ”¯å‡ºè¿˜æ˜¯æ”¶å…¥
	cout << "â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” ğŸ‘€ æŸ¥è¯¢ç»“æœ â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”" << endl;
	cout << "\n ç±»å‹ \t\t é‡‘é¢ \t\t å¤‡æ³¨ \n" << endl;

	// 1.éå†æ‰€æœ‰è´¦ç›®, ç»Ÿè®¡æ€»æ”¶æ”¯
	int total = 0;
	for(auto item: allItems) { //èŒƒå›´ for å¾ªç¯, auto è‡ªåŠ¨æ¨æ–­
		if(item.itemType == type) { // ğŸ”¥ æ ¹æ® type æ¥åˆ¤æ–­æ˜¯æ”¶å…¥è¿˜æ˜¯æ”¯å‡º
			printItem(item);  //ğŸ”¥è®°å¾—åœ¨ account_Item.h è¿›è¡Œå£°æ˜ï¼ï¼
			total += item.amount; //è®¡ç®—æ€»é‡‘é¢ (æœå…¥è´§æ”¯å‡ºï¼‰)
		}
	}

	// 2.è¾“å‡ºä¿¡æ¯
	cout << "â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”" << endl;
	cout << (type == INCOME ? "æ€»æ”¶å…¥: " : "æ€»æ”¯å‡º: " )  << total << endl;
	cout << "æŒ‰å›è½¦é”®è¿”å›ä¸»èœå•" << endl;

	// 3. æ•æ‰ç”¨æˆ·å›è½¦äº‹ä»¶(å›è½¦è¿”å›ä¸»èœå•)
	string line;
	getline(cin, line); //ä¸åšä»»ä½•å¤„ç†, ç›¸å½“äºç›´æ¥ä¸¢å¼ƒè·å¾—çš„ line, ç„¶å return å›åˆ° main å‡½æ•°çš„ while å¾ªç¯å¤„, è¿™é‡Œåˆšå¥½åˆ° break äº†, æ‰€ä»¥æ¯å›åˆ°ã€ä¸»èœå•ã€‘
}




//æ‰“å°è¾“å‡ºè´¦ç›®ä¿¡æ¯çš„æ–¹æ³•
void printItem(const AccountItem& item) { //æ‰“å°è¾“å‡º, ä¸æ›´æ”¹ item, æ‰€ä»¥å®šä¹‰ä¸ºå¸¸é‡
	cout << item.itemType << "\t\t" << item.amount << "\t\t" << item.detail << endl;//ğŸ”¥ğŸ”¥ ã€æ‹¿åˆ°æ•°æ® -> è¿›è¡Œæ‰“å°ã€‘
}